pipeline {
    agent any

    tools {
        git 'Default'                // Jenkins default Git
        jdk 'jdk17'                  // replace with your JDK name from Jenkins
        maven 'maven3'               // replace with your Maven name
        sonar 'sonarscanner'         // the SonarScanner tool name
    }

    environment {
        SONARQUBE_ENV = 'sonarqube'  // SonarQube server name configured in Jenkins
        REPO_URL = 'https://github.com/prakash-128/Book-My-Show.git'
        BRANCH = 'main'
    }

    stages {

        stage('Clean Workspace') {
            steps {
                cleanWs()
                echo '‚úÖ Workspace cleaned successfully.'
            }
        }

        stage('Checkout from Git') {
            steps {
                echo 'üì¶ Cloning repository...'
                git branch: "${BRANCH}", url: "${REPO_URL}"
                sh 'ls -la'
            }
        }

        stage('SonarQube Analysis') {
            steps {
                echo 'üîç Running SonarQube code analysis...'
                withSonarQubeEnv("${SONARQUBE_ENV}") {
                    sh '''
                        sonar-scanner \
                        -Dsonar.projectKey=BookMyShow \
                        -Dsonar.projectName=BookMyShow \
                        -Dsonar.sources=. \
                        -Dsonar.java.binaries=bookmyshow-app/target \
                        -Dsonar.host.url=$SONAR_HOST_URL \
                        -Dsonar.login=$SONAR_AUTH_TOKEN
                    '''
                }
            }
        }

        stage('Build Project') {
            steps {
                echo '‚öôÔ∏è Building the application...'
                sh 'mvn clean package -DskipTests'
            }
        }

        stage('Unit Tests') {
            steps {
                echo 'üß™ Running tests...'
                sh 'mvn test'
            }
        }

        stage('Quality Gate') {
            steps {
                echo 'üõ°Ô∏è Waiting for SonarQube Quality Gate result...'
                timeout(time: 2, unit: 'MINUTES') {
                    waitForQualityGate abortPipeline: true
                }
            }
        }

        stage('Deploy (Optional)') {
            when {
